(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{647:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),l=a(470),i=a(525),u=a.n(i),o=a(245),c=a.n(o),s=a(645),p=a(447),m=a(629),g=a(407),f=a(640),v=a(644),d=a(86),h=a(126),b=a(419),y=a(490),E=a.n(y),O=a(157),C=a.n(O),j=a(538),w=a.n(j),S=a(554),P=a.n(S),k=C()((function(){return{containerRoot:function(e){return{minHeight:e.loading&&"500px"}}}}));function x(e){var t=e.preview,a=e.geoId,l=e.chart,i=Object(n.useMemo)((function(){return l?[l.visual]:[]}),[l]),u=P()({geoId:t?a:null,visuals:t?i:[]}),o=u.profiles,c=u.chartData,s=k({loading:c.isLoading});return!t||!l||!c.isLoading&&c.profileVisualsData[l.visual.queryAlias]&&0===c.profileVisualsData[l.visual.queryAlias].nodes.length?r.a.createElement(p.a,{container:!0,justify:"center",alignItems:"center",style:{height:"400px",backgroundColor:"whitesmoke"}},r.a.createElement(p.a,{item:!0},r.a.createElement(m.a,null,t?Object(b.__)("Data is missing for visualizing this chart.","hurumap-data"):Object(b.__)("Enable preview and select a country to preview the chart configurations dynamically.","hurumap-data")))):r.a.createElement(E.a,{key:l.id,loading:c.isLoading,title:l.title,description:l.description&&l.description[a],classes:{root:s.containerRoot},embedCode:"embed text",action:{handleShare:function(){}},insight:{analysisLink:"#",dataLink:"#",description:"Summary per country goes here.",title:"Summary"},source:l.source&&l.source[a]&&l.source[a].title?l.source[a]:null},!c.isLoading&&r.a.createElement(w.a,{profiles:o,definition:l.stat,data:c.profileVisualsData[l.visual.queryAlias].nodes}),!c.isLoading&&r.a.createElement(w.a,{profiles:o,definition:l.visual,data:c.profileVisualsData[l.visual.queryAlias].nodes}))}x.propTypes={geoId:d.a.string,chart:d.a.shape({id:d.a.string,published:d.a.oneOfType([d.a.string,d.a.bool]),title:d.a.string,subtitle:d.a.string,section:d.a.string,type:d.a.string,visual:d.a.shape({queryAlias:d.a.string}),description:d.a.shape({}),source:d.a.shape({}),stat:d.a.shape({queryAlias:d.a.string}),queryAlias:d.a.string}),preview:d.a.bool},x.defaultProps={geoId:void 0,chart:void 0,preview:!1};var L=x,A=a(87),q=a.n(A);function D(){var e=z(["\n  query geographies {\n    geos: allWazimapGeographies(orderBy: NAME_ASC) {\n      nodes {\n        geoLevel\n        geoCode\n        squareKms\n        parentLevel\n        parentCode\n        longName\n        name\n      }\n    }\n  }\n"]);return D=function(){return e},e}function I(){var e=z(["\n  query dataCounts($geoCode: String!, $geoLevel: String!) {\n    ","(condition: {\n      geoLevel: $geoLevel,\n      geoCode: $geoCode\n    }) {\n      totalCount\n    }\n  }\n"]);return I=function(){return e},e}function z(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var W=function(e){return q()(I(),e)},_=q()(D()),T=a(55);function N(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function R(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?N(Object(a),!0).forEach((function(t){J(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):N(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function J(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var a=[],n=!0,r=!1,l=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,l=e}finally{try{n||null==u.return||u.return()}finally{if(r)throw l}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function U(e){var t=e.chart,a=V(Object(n.useState)(!1),2),i=a[0],u=a[1],o=Object(h.useApolloClient)(),c=V(Object(n.useState)([]),2),m=c[0],g=c[1],f=V(Object(n.useState)(null),2),d=f[0],b=f[1],y=V(Object(n.useState)(t.description?JSON.parse(t.description):{}),2),E=y[0],O=y[1],C=V(Object(n.useState)(t.source?JSON.parse(t.source):{}),2),j=C[0],w=C[1],S=Object(h.useQuery)(_).data;Object(n.useEffect)((function(){var e;regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(!i){a.next=6;break}if(!S){a.next=6;break}return a.next=4,regeneratorRuntime.awrap(Promise.all(S.geos.nodes.map((function(e){var a,n;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(o.query({query:W(t.visual.table),variables:{geoCode:e.geoCode,geoLevel:e.geoLevel}}));case 2:return a=r.sent,n=a.data,r.abrupt("return",R({},e,{totalCount:n[t.visual.table].totalCount}));case 5:case"end":return r.stop()}}))}))));case 4:e=a.sent,g(e.filter((function(e){return 0!==e.totalCount})));case 6:case"end":return a.stop()}}))}),[t.visual.table,i,o,S]);var P=function(e){var a=R({id:t.id},e);Object(T.f)(a)};return r.a.createElement(p.a,{container:!0,direction:"column",spacing:2},r.a.createElement(p.a,{item:!0,container:!0,xs:12,direction:"row",justify:"space-evenly"},r.a.createElement(p.a,{item:!0},r.a.createElement(p.a,{component:"label",item:!0,container:!0,alignItems:"center",spacing:1},r.a.createElement(p.a,{item:!0},"Disable Preview"),r.a.createElement(p.a,{item:!0},r.a.createElement(v.a,{defaultChecked:!1,checked:i,onChange:function(){u(!i)}})),r.a.createElement(p.a,{item:!0},"Enable Preview"))),r.a.createElement(p.a,{item:!0,xs:4},r.a.createElement(l.a,{placeholder:"Select Geography for preview",value:d,options:m?m.map((function(e){return{label:e.name,value:"".concat(e.geoLevel,"-").concat(e.geoCode)}})):[],onChange:function(e){b(e),E[e.value]||O(R({},E,J({},e.value,""))),j[e.value]||w(R({},j,J({},e.value,{title:"",href:""})))}}))),r.a.createElement(p.a,{item:!0,xs:12},i&&d&&r.a.createElement(L,{preview:i,geoId:d.value,chart:R({},t,{queryAlias:"chartPreview",visual:R({},t.visual,{queryAlias:"vizPreview"}),stat:R({},t.stat,{queryAlias:"vizPreview"}),description:E,source:R({},j)})})),r.a.createElement(p.a,{item:!0,container:!0,xs:12,md:7,direction:"column",spacing:2},i&&d&&d.value&&r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,{item:!0},r.a.createElement(s.a,{fullWidth:!0,label:"Description",multiline:!0,rows:"4",value:E[d.value],type:"text",onChange:function(e){O(R({},E,J({},d.value,e.target.value)))},onBlur:function(e){O(R({},E,J({},d.value,e.target.value))),P({description:JSON.stringify(Object.assign(E,J({},d.value,e.target.value)))})}})),r.a.createElement(p.a,{item:!0},r.a.createElement(s.a,{fullWidth:!0,label:"Source Title",placeholder:"Source Title for Geography",value:j[d.value].title,type:"text",InputLabelProps:{shrink:!0},onChange:function(e){w(R({},j,J({},d.value,R({},j[d.value],{title:e.target.value}))))},onBlur:function(e){w(R({},j,J({},d.value,R({},j[d.value],{title:e.target.value})))),P({source:JSON.stringify(R({},j,J({},d.value,R({},j[d.value],{title:e.target.value}))))})}})),r.a.createElement(p.a,{item:!0},r.a.createElement(s.a,{fullWidth:!0,label:"Source Link",placeholder:"Source Link for Geography",value:j[d.value].href,type:"text",InputLabelProps:{shrink:!0},onChange:function(e){w(R({},j,J({},d.value,R({},j[d.value],{href:e.target.value}))))},onBlur:function(e){w(R({},j,J({},d.value,R({},j[d.value],{href:e.target.value})))),P({source:JSON.stringify(R({},j,J({},d.value,R({},j[d.value],{href:e.target.value}))))})}})))))}U.propTypes={chart:d.a.shape({id:d.a.string,published:d.a.oneOfType([d.a.string,d.a.bool]),title:d.a.string,subtitle:d.a.string,section:d.a.string,source:d.a.string,description:d.a.string,type:d.a.string,visual:d.a.string,stat:d.a.string}).isRequired};var B=U;function G(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function M(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?G(Object(a),!0).forEach((function(t){$(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):G(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function $(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function F(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var H=[{label:"Custom",value:""},{label:"Percent",value:"percent"},{label:"Currency",value:"currency"}],K=[{label:"Pie",value:"pie"},{label:"Column",value:"column"},{label:"Grouped Column",value:"grouped_column"},{label:"Number",value:"number"}],Q=[{label:"Raw",value:"raw"},{label:"Avg",value:"avg"},{label:"Max",value:"max"},{label:"Min",value:"min"},{label:"Sum",value:"sum"},{label:"Sum (Percent)",value:"sum:percent"},{label:"First",value:"first"},{label:"First (Percent)",value:"first:percent"},{label:"Last",value:"last"},{label:"Last (Percent)",value:"last:percent"}];function X(e){var t=e.chart,a=e.data,i=e.sectionOptions,o=e.onChange,d=Object(n.useMemo)((function(){return t.stat?JSON.parse(t.stat):{type:"number",subtitle:t.subtitle,description:"",aggregate:"sum",unique:!0,unit:"percent"}}),[t]),h=Object(n.useMemo)((function(){var e=t.visual?JSON.parse(t.visual):{typeProps:{}};return e.typeProps=e.typeProps||{horizontal:e.horizontal},c.a.omit(e,"horizontal")}),[t.visual]),b=function(e){return e?u.a.singular(e.slice(3)):""},y=Object(n.useMemo)((function(){if(h.table){var e=b(h.table);return a&&a.__schema.types.find((function(t){return e===t.name}))?a.__schema.types.find((function(t){return e===t.name})).fields.filter((function(e){return!/id|nodeId|By/g.test(e.name)})).map((function(e){return{label:e.name,value:e.name}})):[]}return[]}),[a,h]),E=function(e){o({visual:JSON.stringify(c.a.merge(h,e))})},O=function(e){o({stat:JSON.stringify(Object.assign(d,e))})};return r.a.createElement(g.a,{style:{padding:10}},r.a.createElement(p.a,{container:!0,spacing:2},r.a.createElement(p.a,{item:!0,xs:12,md:3,container:!0,direction:"column",spacing:1},r.a.createElement(p.a,{item:!0},r.a.createElement(s.a,{label:"Title",value:t.title,InputLabelProps:{shrink:!0},onChange:function(e){o({title:e.target.value})},fullWidth:!0})),r.a.createElement(p.a,{item:!0},r.a.createElement(s.a,{label:"Subtitle",InputLabelProps:{shrink:!0},value:t.subtitle,onChange:function(e){o({subtitle:e.target.value}),O({subtitle:e.target.value})},fullWidth:!0})),r.a.createElement(p.a,{item:!0},r.a.createElement(f.a,{shrink:!0},"Section"),r.a.createElement(l.a,{placeholder:"Select section",value:i.find((function(e){return e.value===t.section})),options:i,onChange:function(e){var t=e.value;o({section:t})}})),r.a.createElement(p.a,{item:!0},r.a.createElement(f.a,{shrink:!0},"Visual type"),r.a.createElement(l.a,{placeholder:"Select chart type",value:K.find((function(e){return e.value===h.type})),options:K,onChange:function(e){var t=e.value;E({type:t})}})),h.type&&h.type.includes("column")&&r.a.createElement(p.a,{item:!0,container:!0,component:"label",alignItems:"center",spacing:1},r.a.createElement(p.a,{item:!0},"Column: Vertical"),r.a.createElement(p.a,{item:!0},r.a.createElement(v.a,{size:"small",defaultChecked:!1,checked:h.typeProps.horizontal,onChange:function(e,t){E({typeProps:{horizontal:t}})}})),r.a.createElement(p.a,{item:!0},"Horizontal")),r.a.createElement(p.a,{item:!0},r.a.createElement(f.a,{shrink:!0},"Table"),r.a.createElement(l.a,{placeholder:"Select a chart table",options:a?a.__schema.types[0].fields.filter((function(e){return"all"===e.name.slice(0,3)})).filter((function(e){return!/Takwimu|Wagtail|Django|Hurumap|Wazimap|Account|Auth|Census/g.test(e.name)||/WazimapGeographies/g.test(e.name)})).map((function(e){return{label:u.a.singular(e.name.slice(3)),value:e.name}})):[],value:{value:h.table,label:b(h.table)},onChange:function(e){var t=e.value;E({table:t})}})),r.a.createElement(p.a,{item:!0},r.a.createElement(f.a,{shrink:!0},"Data Label"),r.a.createElement(l.a,{placeholder:"Select labels field",value:y.find((function(e){return e.value===h.x})),options:y.filter((function(e){return e.value!==h.y})),onChange:function(e){var t=e.value;E({x:t})}})),r.a.createElement(p.a,{item:!0,container:!0,spacing:1},r.a.createElement(p.a,{item:!0,xs:6},r.a.createElement(f.a,{shrink:!0},"Data Unit Style"),r.a.createElement(l.a,{defaultValue:H[0],placeholder:"Style",value:H.find((function(e){return e.value===h.style})),options:H,onChange:function(e){var t=e.value;E({style:t})}})),r.a.createElement(p.a,{item:!0,xs:6},!h.style&&r.a.createElement(s.a,{label:"Unit",InputLabelProps:{shrink:!0},value:h.customUnit,onChange:function(e){E({customUnit:e.target.value})},fullWidth:!0}),"currency"===h.style&&r.a.createElement(s.a,{label:"Currency Code",InputLabelProps:{shrink:!0},value:h.currency,onChange:function(e){E({currency:e.target.value})},fullWidth:!0}))),r.a.createElement(p.a,{item:!0,container:!0,spacing:1},r.a.createElement(p.a,{item:!0,xs:4},r.a.createElement(f.a,{shrink:!0},"Aggregate"),r.a.createElement(l.a,{defaultValue:Q[0],placeholder:"Aggregate",value:Q.find((function(e){return e.value===h.aggregate})),options:Q,onChange:function(e){var t=e.value;E({aggregate:t})}})),r.a.createElement(p.a,{item:!0,xs:8},r.a.createElement(f.a,{shrink:!0},"Data Value"),r.a.createElement(l.a,{placeholder:"Select data field",value:y.find((function(e){return e.value===h.y})),options:y.filter((function(e){return e.value!==h.x})),onChange:function(e){var t=e.value;E({y:t})}}))),r.a.createElement(p.a,{item:!0},r.a.createElement(f.a,{shrink:!0},"Group by"),r.a.createElement(l.a,{placeholder:"Select group by field (optional)",value:y.find((function(e){return e.value===h.groupBy}))||{label:"none",value:""},options:[].concat(F(y),[{label:"none",value:""}]),onChange:function(e){var t=e.value;E({groupBy:t})}})),r.a.createElement(p.a,{item:!0},r.a.createElement(m.a,null,"Stat")),r.a.createElement(p.a,{item:!0},r.a.createElement(s.a,{label:"Description",placeholder:"Statistic visual description",InputLabelProps:{shrink:!0},value:d.description,onChange:function(e){O({description:e.target.value})},fullWidth:!0,multiline:!0})),r.a.createElement(p.a,{item:!0,container:!0,spacing:1},r.a.createElement(p.a,{item:!0,xs:6},r.a.createElement(f.a,{shrink:!0},"Aggregate"),r.a.createElement(l.a,{defaultValue:Q[0],placeholder:"Aggregate",value:Q.find((function(e){return e.value===d.aggregate})),options:Q,onChange:function(e){var t=e.value;O({aggregate:t})}})),r.a.createElement(p.a,{item:!0,xs:6,component:"label",container:!0,alignItems:"center",spacing:1,wrap:"nowrap"},r.a.createElement(p.a,{item:!0},r.a.createElement(v.a,{size:"small",defaultChecked:!1,checked:d.unique,onChange:function(e,t){O({unique:t})}})),r.a.createElement(p.a,{item:!0},"Aggregate ",r.a.createElement("b",null,d.unique?"with respect":"irrespective")," ",d.unique?"to":"of"," ",r.a.createElement("b",null,"Data Label")))),r.a.createElement(p.a,{item:!0,container:!0,spacing:1},r.a.createElement(p.a,{item:!0,xs:6},r.a.createElement(f.a,{shrink:!0},"Statistic Unit Style"),r.a.createElement(l.a,{defaultValue:H[0],placeholder:"Style",value:H.find((function(e){return e.value===h.style})),options:H,onChange:function(e){var t=e.value;O({style:t})}})),r.a.createElement(p.a,{item:!0,xs:6},!h.style&&r.a.createElement(s.a,{label:"Unit",InputLabelProps:{shrink:!0},value:h.customUnit,onChange:function(e){O({customUnit:e.target.value})},fullWidth:!0}),"currency"===h.style&&r.a.createElement(s.a,{label:"Currency Code",InputLabelProps:{shrink:!0},value:h.currency,onChange:function(e){O({currency:e.target.value})},fullWidth:!0}))),r.a.createElement(p.a,{component:"label",item:!0,container:!0,alignItems:"center",spacing:1},r.a.createElement(p.a,{item:!0},"Draft"),r.a.createElement(p.a,{item:!0},r.a.createElement(v.a,{defaultChecked:!1,checked:"1"===t.published||!0===t.published,onChange:function(e,t){o({published:t})}})),r.a.createElement(p.a,{item:!0},"Published"))),r.a.createElement(p.a,{item:!0,xs:12,md:9},r.a.createElement(B,{chart:M({},t,{visual:h,stat:d})}))))}X.propTypes={chart:d.a.shape({published:d.a.oneOfType([d.a.string,d.a.bool]),title:d.a.string,subtitle:d.a.string,section:d.a.string,type:d.a.string,visual:d.a.string,stat:d.a.string}).isRequired,data:d.a.shape({__schema:d.a.shape({types:d.a.arrayOf(d.a.shape({fields:d.a.arrayOf(d.a.shape({}))}))})}).isRequired,onChange:d.a.func.isRequired,sectionOptions:d.a.arrayOf(d.a.shape({})).isRequired};t.default=X}}]);